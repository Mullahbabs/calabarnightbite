// Vendor data
const vendors = {
  daddyk: {
    name: "Daddy K's",
    items: [
      {
        id: 1,
        name: "Pepper Soup",
        description: "Spicy assorted meat pepper soup",
        price: 1500,
        minAmount: 1500,
        image: "img/about.jpg",
      },
      {
        id: 2,
        name: "Suya",
        description: "Grilled spicy beef skewers",
        price: 500,
        minAmount: 500,
        image: "img/m2.JPG",
      },
      {
        id: 3,
        name: "Jollof Rice",
        description: "Spicy tomato rice with chicken",
        price: 1200,
        minAmount: 1200,
        image: "img/m3.JPG",
      },
      {
        id: 4,
        name: "Fried Plantain",
        description: "Ripe plantain fried to perfection",
        price: 800,
        minAmount: 800,
        image: "img/m4.JPG",
      },
      {
        id: 5,
        name: "Pepper Soup",
        description: "Spicy assorted meat pepper soup",
        price: 1500,
        minAmount: 1500,
        image: "img/m1.JPG",
      },
      {
        id: 6,
        name: "Suya",
        description: "Grilled spicy beef skewers",
        price: 500,
        minAmount: 500,
        image: "img/m2.JPG",
      },
      {
        id: 7,
        name: "Jollof Rice",
        description: "Spicy tomato rice with chicken",
        price: 1200,
        minAmount: 1200,
        image: "img/m3.JPG",
      },
      {
        id: 8,
        name: "Fried Plantain",
        description: "Ripe plantain fried to perfection",
        price: 800,
        minAmount: 800,
        image: "img/m4.JPG",
      },
    ],
  },
  ifeco: {
    name: "Ifeco's Kitchen",
    items: [
      {
        id: 9,
        name: "Grilled Fish",
        description: "Fresh fish grilled with spices",
        price: 2500,
        minAmount: 2500,
        image: "https://source.unsplash.com/random/300x200/?grilled+fish",
      },
      {
        id: 10,
        name: "Pounded Yam & Egusi",
        description: "Local delicacy with melon soup",
        price: 1800,
        minAmount: 1800,
        image: "https://source.unsplash.com/random/300x200/?pounded+yam",
      },
      {
        id: 11,
        name: "Afang Soup",
        description: "Traditional Calabar vegetable soup",
        price: 2000,
        minAmount: 2000,
        image: "https://source.unsplash.com/random/300x200/?afang+soup",
      },
      {
        id: 12,
        name: "Roasted Yam",
        description: "Yam roasted with palm oil sauce",
        price: 1000,
        minAmount: 1000,
        image: "https://source.unsplash.com/random/300x200/?roasted+yam",
      },
      {
        id: 13,
        name: "Grilled Fish",
        description: "Fresh fish grilled with spices",
        price: 2500,
        minAmount: 2500,
        image: "https://source.unsplash.com/random/300x200/?grilled+fish",
      },
      {
        id: 14,
        name: "Pounded Yam & Egusi",
        description: "Local delicacy with melon soup",
        price: 1800,
        minAmount: 1800,
        image: "https://source.unsplash.com/random/300x200/?pounded+yam",
      },
      {
        id: 15,
        name: "Afang Soup",
        description: "Traditional Calabar vegetable soup",
        price: 2000,
        minAmount: 2000,
        image: "https://source.unsplash.com/random/300x200/?afang+soup",
      },
      {
        id: 16,
        name: "Roasted Yam",
        description: "Yam roasted with palm oil sauce",
        price: 1000,
        minAmount: 1000,
        image: "https://source.unsplash.com/random/300x200/?roasted+yam",
      },
    ],
  },
  officepub: {
    name: "Office Pub Kitchen",
    items: [
      {
        id: 17,
        name: "Edikang Ikong",
        description: "Pumpkin leaves and waterleaf soup",
        price: 2200,
        minAmount: 2200,
        image: "https://source.unsplash.com/random/300x200/?edikang+ikong",
      },
      {
        id: 18,
        name: "Fisherman Soup",
        description: "Rich seafood soup",
        price: 3000,
        minAmount: 3000,
        image: "https://source.unsplash.com/random/300x200/?fisherman+soup",
      },
      {
        id: 19,
        name: "White Rice & Stew",
        description: "Local rice with beef stew",
        price: 1500,
        minAmount: 1500,
        image: "https://source.unsplash.com/random/300x200/?rice+stew",
      },
      {
        id: 20,
        name: "Moi Moi",
        description: "Steamed bean pudding",
        price: 700,
        minAmount: 700,
        image: "https://source.unsplash.com/random/300x200/?moi+moi",
      },
      {
        id: 21,
        name: "Edikang Ikong",
        description: "Pumpkin leaves and waterleaf soup",
        price: 2200,
        minAmount: 2200,
        image: "https://source.unsplash.com/random/300x200/?edikang+ikong",
      },
      {
        id: 22,
        name: "Fisherman Soup",
        description: "Rich seafood soup",
        price: 3000,
        minAmount: 3000,
        image: "https://source.unsplash.com/random/300x200/?fisherman+soup",
      },
      {
        id: 23,
        name: "White Rice & Stew",
        description: "Local rice with beef stew",
        price: 1500,
        minAmount: 1500,
        image: "https://source.unsplash.com/random/300x200/?rice+stew",
      },
      {
        id: 24,
        name: "Moi Moi",
        description: "Steamed bean pudding",
        price: 700,
        minAmount: 700,
        image: "https://source.unsplash.com/random/300x200/?moi+moi",
      },
    ],
  },
  karris: {
    name: "Karris Hotpot",
    items: [
      {
        id: 25,
        name: "Nkwobi",
        description: "Spicy cow foot delicacy",
        price: 2500,
        minAmount: 2500,
        image: "https://source.unsplash.com/random/300x200/?nkwobi",
      },
      {
        id: 26,
        name: "Isi Ewu",
        description: "Spicy goat head",
        price: 2800,
        minAmount: 2800,
        image: "https://source.unsplash.com/random/300x200/?isi+ewu",
      },
      {
        id: 27,
        name: "Abak Atama",
        description: "Palm fruit soup with atama leaves",
        price: 2000,
        minAmount: 2000,
        image: "https://source.unsplash.com/random/300x200/?abak+atama",
      },
      {
        id: 28,
        name: "Ukwa",
        description: "Breadfruit porridge",
        price: 1500,
        minAmount: 1500,
        image: "https://source.unsplash.com/random/300x200/?ukwa",
      },
      {
        id: 29,
        name: "Nkwobi",
        description: "Spicy cow foot delicacy",
        price: 2500,
        minAmount: 2500,
        image: "https://source.unsplash.com/random/300x200/?nkwobi",
      },
      {
        id: 30,
        name: "Isi Ewu",
        description: "Spicy goat head",
        price: 2800,
        minAmount: 2800,
        image: "https://source.unsplash.com/random/300x200/?isi+ewu",
      },
      {
        id: 31,
        name: "Abak Atama",
        description: "Palm fruit soup with atama leaves",
        price: 2000,
        minAmount: 2000,
        image: "https://source.unsplash.com/random/300x200/?abak+atama",
      },
      {
        id: 32,
        name: "Ukwa",
        description: "Breadfruit porridge",
        price: 1500,
        minAmount: 1500,
        image: "https://source.unsplash.com/random/300x200/?ukwa",
      },
    ],
  },
};

// Cart state
let cart = [];
const serviceFee = 300;
const deliveryFee = 500;

// DOM elements
const cartPreview = document.getElementById("cartPreview");
const cartCount = document.getElementById("cartCount");
const cartTotal = document.getElementById("cartTotal");
const flashMessage = document.getElementById("flashMessage");
const cartModal = document.getElementById("cartModal");
const cartItems = document.getElementById("cartItems");
const subtotal = document.getElementById("subtotal");
const grandTotal = document.getElementById("grandTotal");
const checkoutModal = document.getElementById("checkoutModal");
const deliveryForm = document.getElementById("deliveryForm");

// Carousel elements
const carouselInner = document.querySelector(".carousel-inner");
const carouselItems = document.querySelectorAll(".carousel-item");
const indicators = document.querySelectorAll(".indicator");
let currentSlide = 0;
let slideInterval;

// Initialize the app
document.addEventListener("DOMContentLoaded", function () {
  loadMenuItems();
  updateCartPreview();

  // Load cart from localStorage if available
  const savedCart = localStorage.getItem("nightBitesCart");
  if (savedCart) {
    cart = JSON.parse(savedCart);
    updateCartPreview();
  }
});

// Load menu items for all vendors
function loadMenuItems() {
  for (const vendorId in vendors) {
    const vendor = vendors[vendorId];
    const menuContainer = document.querySelector(`#${vendorId} .menu-items`);

    vendor.items.forEach((item) => {
      const menuItem = document.createElement("div");
      menuItem.className = "menu-item";
      menuItem.innerHTML = `
                <img src="${item.image}" alt="${item.name}">
                <div class="menu-item-content">
                    <h3>${item.name}</h3>
                    <p>${item.description}</p>
                    <span class="price">From â‚¦${item.minAmount.toLocaleString()}</span>
                    <button class="add-to-cart" data-id="${
                      item.id
                    }" data-vendor="${vendorId}">Add to Cart</button>
                </div>
            `;
      menuContainer.appendChild(menuItem);
    });
  }

  // Add event listeners to all add-to-cart buttons
  document.querySelectorAll(".add-to-cart").forEach((button) => {
    button.addEventListener("click", addToCart);
  });
}

// Add item to cart
function addToCart(e) {
  const button = e.target;
  const itemId = parseInt(button.getAttribute("data-id"));
  const vendorId = button.getAttribute("data-vendor");

  // Find the vendor and item
  const vendor = vendors[vendorId];
  const item = vendor.items.find((i) => i.id === itemId);

  // Check if item already exists in cart
  const existingItem = cart.find(
    (i) => i.id === item.id && i.vendor === vendorId
  );

  if (existingItem) {
    existingItem.quantity += 1;
    existingItem.amount = Math.max(existingItem.amount, existingItem.minAmount);
  } else {
    cart.push({
      id: item.id,
      name: item.name,
      vendor: vendorId,
      vendorName: vendor.name,
      price: item.price,
      minAmount: item.minAmount,
      amount: item.minAmount,
      quantity: 1,
    });
  }

  // Save to localStorage
  localStorage.setItem("nightBitesCart", JSON.stringify(cart));

  // Update UI
  updateCartPreview();
  showFlashMessage(`${item.name} added to cart`);
}

// Show flash message
function showFlashMessage(message) {
  flashMessage.textContent = message;
  flashMessage.style.display = "block";

  setTimeout(() => {
    flashMessage.style.animation = "fadeOut 0.3s";
    setTimeout(() => {
      flashMessage.style.display = "none";
      flashMessage.style.animation = "fadeIn 0.3s";
    }, 300);
  }, 2000);
}

// Carousel functions
function startCarousel() {
  slideInterval = setInterval(nextSlide, 5000);
}

function nextSlide() {
  goToSlide((currentSlide + 1) % carouselItems.length);
}

function prevSlide() {
  goToSlide((currentSlide - 1 + carouselItems.length) % carouselItems.length);
}

function goToSlide(n) {
  carouselItems[currentSlide].classList.remove("active");
  indicators[currentSlide].classList.remove("active");

  currentSlide = n;

  carouselItems[currentSlide].classList.add("active");
  indicators[currentSlide].classList.add("active");
  carouselInner.style.transform = `translateX(-${currentSlide * 100}%)`;

  // Reset timer when manually changing slides
  clearInterval(slideInterval);
  startCarousel();
}

function moveSlide(n) {
  if (n > 0) {
    nextSlide();
  } else {
    prevSlide();
  }
}

// Navbar scroll effect
function handleScroll() {
  if (window.scrollY > 50) {
    document.querySelector(".navbar").classList.add("scrolled");
  } else {
    document.querySelector(".navbar").classList.remove("scrolled");
  }
}

// Mobile menu functions
function toggleMobileMenu() {
  navLinks.classList.toggle("active");
  hamburger.innerHTML = navLinks.classList.contains("active")
    ? '<i class="fas fa-times"></i>'
    : '<i class="fas fa-bars"></i>';
}

function closeMobileMenu() {
  navLinks.classList.remove("active");
  hamburger.innerHTML = '<i class="fas fa-bars"></i>';
}

// Update cart preview
function updateCartPreview() {
  const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
  const totalAmount = cart.reduce(
    (sum, item) => sum + item.amount * item.quantity,
    0
  );

  cartCount.textContent = totalItems;
  cartTotal.textContent = totalAmount.toLocaleString();
}

// Toggle cart modal
function toggleCart() {
  if (cartModal.style.display === "block") {
    cartModal.style.display = "none";
  } else {
    renderCart();
    cartModal.style.display = "block";
  }
}

// Render cart items
function renderCart() {
  if (cart.length === 0) {
    cartItems.innerHTML = "<p>Your cart is empty</p>";
    subtotal.textContent = "0";
    grandTotal.textContent = (serviceFee + deliveryFee).toLocaleString();
    return;
  }

  let itemsHTML = "";
  let total = 0;

  cart.forEach((item, index) => {
    total += item.amount * item.quantity;

    itemsHTML += `
            <div class="cart-item">
                <div class="cart-item-info">
                    <h4>${item.name}</h4>
                    <p>${item.vendorName}</p>
                    <p>â‚¦${item.amount.toLocaleString()} per plate (min: â‚¦${item.minAmount.toLocaleString()})</p>
                </div>
                <div class="cart-item-controls">
                    <input type="number" min="1" value="${item.quantity}" 
                        onchange="updateCartItem(${index}, this.value, 'quantity')">
                    <input type="number" min="${item.minAmount}" value="${
      item.amount
    }" 
                        onchange="updateCartItem(${index}, this.value, 'amount')">
                    <span class="remove-item" onclick="removeFromCart(${index})">Remove</span>
                </div>
            </div>
        `;
  });

  cartItems.innerHTML = itemsHTML;
  subtotal.textContent = total.toLocaleString();
  grandTotal.textContent = (total + serviceFee + deliveryFee).toLocaleString();
}

// Update cart item quantity or amount
function updateCartItem(index, value, type) {
  const item = cart[index];

  if (type === "quantity") {
    item.quantity = parseInt(value) || 1;
  } else if (type === "amount") {
    const amount = parseFloat(value) || item.minAmount;
    item.amount = Math.max(amount, item.minAmount);
  }

  // Save to localStorage
  localStorage.setItem("nightBitesCart", JSON.stringify(cart));

  // Update UI
  renderCart();
  updateCartPreview();
}

// Remove item from cart
function removeFromCart(index) {
  cart.splice(index, 1);

  // Save to localStorage
  localStorage.setItem("nightBitesCart", JSON.stringify(cart));

  // Update UI
  renderCart();
  updateCartPreview();
}

// Proceed to checkout
function checkout() {
  if (cart.length === 0) {
    alert("Your cart is empty");
    return;
  }

  cartModal.style.display = "none";
  checkoutModal.style.display = "block";
}

// Close checkout modal
function closeCheckout() {
  checkoutModal.style.display = "none";
}

// Submit delivery form
deliveryForm.addEventListener("submit", function (e) {
  e.preventDefault();

  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;
  const address = document.getElementById("address").value;
  const instructions = document.getElementById("instructions").value;

  // Prepare order data
  const order = {
    customer: { name, phone, address, instructions },
    items: cart,
    subtotal: cart.reduce((sum, item) => sum + item.amount * item.quantity, 0),
    serviceFee,
    deliveryFee,
    total:
      cart.reduce((sum, item) => sum + item.amount * item.quantity, 0) +
      serviceFee +
      deliveryFee,
    date: new Date().toISOString(),
  };

  // In a real app, you would send this to your backend
  console.log("Order placed:", order);
  showConfirmationModal(phone);

  // Show confirmation
  function showConfirmationModal(phone) {
    const modal = document.getElementById("confirmationModal");
    modal.style.display = "flex";
    modal.querySelector(
      ".modal-body p"
    ).innerHTML = `We'll call you at <strong>${phone}</strong> to confirm your order.`;
  }

  function closeConfirmationModal() {
    document.getElementById("confirmationModal").style.display = "none";
  }

  // Clear cart
  cart = [];
  localStorage.removeItem("nightBitesCart");
  updateCartPreview();
  closeCheckout();
  deliveryForm.reset();
});

// Tab functionality
function openTab(evt, tabName) {
  const tabContents = document.getElementsByClassName("tab-content");
  for (let i = 0; i < tabContents.length; i++) {
    tabContents[i].style.display = "none";
  }

  const tabButtons = document.getElementsByClassName("tab-button");
  for (let i = 0; i < tabButtons.length; i++) {
    tabButtons[i].className = tabButtons[i].className.replace(" active", "");
  }

  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}

// Tab Functionality
document.querySelectorAll(".legal-tab").forEach((tab) => {
  tab.addEventListener("click", () => {
    // Remove active class from all tabs and contents
    document
      .querySelectorAll(".legal-tab, .legal-tab-content")
      .forEach((el) => {
        el.classList.remove("active");
      });

    // Activate clicked tab
    tab.classList.add("active");

    // Show corresponding content
    const tabId = tab.getAttribute("data-tab");
    document.getElementById(tabId).classList.add("active");
  });
});

window.closeConfirmationModal = function () {
  document.getElementById("confirmationModal").style.display = "none";
};
